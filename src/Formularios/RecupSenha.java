/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * RecupSenha.java
 *
 * Created on 01/04/2014, 15:07:25
 */
package Formularios;

import Utilitarios.Email;
import java.sql.Connection;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.swing.JOptionPane;

/**
 *
 * @author Abel
 */
public class RecupSenha extends javax.swing.JFrame {
    
    Connection conexao;

    /** Creates new form RecupSenha */
    public RecupSenha() {
        
            initComponents();
            
         
       
       
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lblTopo = new javax.swing.JLabel();
        lblLinha1 = new javax.swing.JLabel();
        lblLinha2 = new javax.swing.JLabel();
        txtEmail = new javax.swing.JTextField();
        lblEmail = new javax.swing.JLabel();
        btnCancelar = new javax.swing.JButton();
        btnRecuperar = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Recuperar Senha");
        setResizable(false);

        lblTopo.setFont(new java.awt.Font("SansSerif", 0, 36));
        lblTopo.setText("Recuperar Senha");

        lblLinha1.setText("Para recuperar a senha, informe seu email usado na hora do cadastro. Lembre-se que será");

        lblLinha2.setText("verificado se você possui uma conta de usuário no sistema.");

        txtEmail.setFont(new java.awt.Font("Dialog", 0, 18));

        lblEmail.setText("Email");

        btnCancelar.setText("Cancelar");
        btnCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelarActionPerformed(evt);
            }
        });

        btnRecuperar.setText("Recuperar Senha");
        btnRecuperar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRecuperarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblTopo)
                            .addComponent(lblLinha1)
                            .addComponent(lblLinha2)
                            .addComponent(lblEmail)
                            .addComponent(txtEmail, javax.swing.GroupLayout.PREFERRED_SIZE, 428, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 16, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnRecuperar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnCancelar)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblTopo)
                .addGap(18, 18, 18)
                .addComponent(lblLinha1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblLinha2)
                .addGap(23, 23, 23)
                .addComponent(lblEmail)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtEmail, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 120, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnCancelar)
                    .addComponent(btnRecuperar))
                .addContainerGap())
        );

        setSize(new java.awt.Dimension(489, 376));
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void btnCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelarActionPerformed
        dispose();
    }//GEN-LAST:event_btnCancelarActionPerformed

    private void btnRecuperarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRecuperarActionPerformed

    
        
        if("Recuperar Senha".equals(btnRecuperar.getText())){
           
               
           
            if(validarEmail(txtEmail.getText()) == true){
   
                btnRecuperar.setEnabled(false);
                btnCancelar.setEnabled(false);
                
                if(new Email().enviaEsqueciSenha(txtEmail.getText()) == true){
                    enviado();
                }else{
                    semSussesso();
                }
                
               
                
           
           
            }else{
                JOptionPane.showMessageDialog(null, "Insira um email, ou um email válido", null, WIDTH);
            }//FIM IF VALIDAR EMAIL
            
            
           
       }else{
            
            dispose();
          
       }//FIM IF EVENTO DOS BOTOES
       
       
    }//GEN-LAST:event_btnRecuperarActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {

            public void run() {
                new RecupSenha().setVisible(true);
            }
        });
    }
    
    
    private static boolean validarEmail(String email){
        
        boolean isEmailValid = false;
        
        if(email != null && email.length() > 0){
            
            String expression = "^[\\w\\.-]+@([\\w\\-]+\\.)+[A-Z]{2,4}$";
            Pattern pattern = Pattern.compile(expression, Pattern.CASE_INSENSITIVE);
            Matcher matcher = pattern.matcher(email);
            
            if(matcher.matches()){
                isEmailValid = true;
            }
            
        }
        
        
        return isEmailValid;
    }
   
    public void enviado(){
        
        
        btnRecuperar.setEnabled(true);
        
        lblTopo.setText("Email enviado com sucesso!");
        lblLinha1.setText("O Email com a recuperação da senha foi enviado. Verifique sua caixa de entrada, ");
        lblLinha2.setText("se o email ainda não chegou, aguarde alguns minutos, e verifique novamente");
        lblEmail.setVisible(false);
        btnRecuperar.setText("OK");
        txtEmail.setVisible(false);
        
    }
    private void semSussesso(){
        
        btnRecuperar.setVisible(false);
        btnCancelar.setEnabled(true);
        lblTopo.setText("Email não enviado!");
        lblLinha1.setText("O Email não foi enviado, ago deu errado, verifique sua conexao com a internet, ");
        lblLinha2.setText("ou se colocou um email que você usou para cadastrar sua conta de usuário.");
        lblEmail.setVisible(false);
        
        txtEmail.setVisible(false);
    }
    
  
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCancelar;
    private javax.swing.JButton btnRecuperar;
    private javax.swing.JLabel lblEmail;
    private javax.swing.JLabel lblLinha1;
    private javax.swing.JLabel lblLinha2;
    private javax.swing.JLabel lblTopo;
    private javax.swing.JTextField txtEmail;
    // End of variables declaration//GEN-END:variables
}
